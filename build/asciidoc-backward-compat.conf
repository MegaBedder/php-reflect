#
# asciidoc-backward-compat.conf
#
# An AsciiDoc configuration to make documentation wrote for AsciiDoc backends
# that add additional macros not supported by AsciiDoc.
#
# e.g: AsciiDoc-Bootstrap backend adds an icon inline macro that does not exists
#      in standard AsciiDoc distribution.
#
# author Laurent Laville <laurent.laville@gmail.com>
# version 1.0.0
# license ASLv2
#

[attributes]
disable-image=

[macros]
# icon inline macro used by AsciiDoc-Bootstrap backend
(?su)(?<!\w)[\\]?(?P<name>icon):(?P<target>\S*?)\[(?P<attrlist>.*?)(?<!\\)\]=

[icon-inlinemacro]
ifndef::disable-image[]
<span class="image{role? {role}}">
<a class="image" href="{link}">
{data-uri%}<img src="{iconsdir=./images/icons}/{target}.png" alt="{alt={target}}"{title? title="{title}"} width="{width=48}" height="{height=48}" />
{data-uri#}<img alt="{alt={target}}"{title? title="{title}"} width="{width=48}" height="{height=48}" src="data:image/{eval:os.path.splitext(r'{target}.png')[1][1:]};base64,
{data-uri#}{sys3:"{python}" -u -c "import base64,sys; base64.encode(sys.stdin,sys.stdout)" < "{eval:os.path.join(r"{indir={outdir}}",r"{iconsdir=}",r"{target}.png")}"}" />
{link#}</a>
</span>
endif::disable-image[]
ifdef::disable-image[]
<span class="image{role? {role}}">
<a class="image" href="{link}">
{link#}</a>
</span>
endif::disable-image[]
